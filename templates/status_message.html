<style>

.status-message-notification {
  background-color: #3298DC;
  position: fixed;
  max-width: 75vw;
  top: 0.35rem;
  left: 0;
  right: 0;
  margin: 0 auto;
  padding: 0.5rem 1rem;

  font-size: 1.2rem;
  color: white;
  text-align: center;

  cursor: pointer;
  border: none;
  border-radius: 0.5rem;
  z-index: 100;
}

</style>


<div class="status-message-notification-container">
  <button id="status-message-notification"
          class="status-message-notification"
          @click="statusMessageClear"
          x-data="statusMessageNotificationData()"
          x-show.transition.opacity.duration.500ms="show"
          x-text="statusMessageText"
          x-cloak
          @status-message-display.window="receiveStatusMessageDisplay($event)">
  </button>
</div>


<script>
  function statusMessageNotificationData() {
    return {
      // data
      show: false,
      statusMessageText: '',
      statusMessageTimeout: undefined,

      // methods
      getColors(messageType) {
        let background = '';
        let text = '';
        if (messageType === '20') {
          background = 'info';
          text = 'white';
        } else if (messageType === '25') {
          background = 'success';
          text = 'white';
        } else if (messageType === '30') {
          background = 'warning';
          text = 'black';
        } else if (messageType === '40') {
          background = 'danger';
          text = 'white';
        }
        if (background) {
          return { background, text };
        } else {
          return {
            background: 'info',
            text: 'white'
          };
        }
      },

      statusMessageDisplay(message, timeout=undefined, messageType=undefined) {
        // if a status message is already present,
        // then clear it and display a new one
        if (this.statusMessageText) {
          this.statusMessageClear();
          setTimeout(() => {
            this.statusMessageDisplay(message, timeout);
          }, defaultTransitionLength);
          return false;
        }

        clearTimeout(this.statusMessageTimeout);
        if (timeout === undefined) {
          // if no timeout is given, display the message for 4 seconds
          timeout = defaultMessageTimeout;
        } else if (timeout === -1) {
          // if timeout == -1, display the message forever
          timeout = 9999999;
        }

        // apply colors, if applicable
        let colors = {};
        let currentEl = document.querySelector('#status-message-notification');
        if (messageType) {
          colors = this.getColors(messageType);
          if (currentEl) {
            // add colors
            currentEl.classList.add(`has-background-${colors.background}`);
            currentEl.classList.add(`has-text-${colors.text}`);
            // remove colors
            setTimeout(() => {
              currentEl.classList.remove(`has-background-${colors.background}`);
              currentEl.classList.remove(`has-text-${colors.text}`);
            }, timeout + defaultTransitionLength)
          }
        }

        // display the message
        this.show = true;
        this.statusMessageText = message;
        this.statusMessageTimeout = setTimeout(() => {
          // clear the message and remove the colorClass
          this.statusMessageClear();
        }, timeout);
      },

      statusMessageClear() {
        clearTimeout(this.statusMessageTimeout);
        this.show = false;
        setTimeout(() => {
          this.statusMessageText = '';
        }, defaultTransitionLength)
      },

      receiveStatusMessageDisplay(event) {
        if (typeof(event.detail) === 'string') {
          this.statusMessageDisplay(event.detail);
        } else {
          this.statusMessageDisplay(event.detail.message,
            event.detail.timeout, event.detail.messageType);
        }
      }
    }
  }
</script>


<script>
{% if messages %}
  {% for message in messages %}
    setTimeout(() => {
      hDispatch('status-message-display', {
        message: "{{ message }}",
        messageType: '{{ message.level }}'
      })
    }, {{ forloop.counter0 }} * defaultMessageTimeout);
  {% endfor %}
{% endif %}
</script>
